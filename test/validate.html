<!doctype html>

<head>
  <meta charset="UTF-8">
  <title>vaadin-text-field tests</title>

  <script src="../../web-component-tester/browser.js"></script>
  <link rel="import" href="../vaadin-text-field.html">
  <link rel="import" href="../../iron-form/iron-form.html">

</head>

<body>
  <test-fixture id="default">
    <template>
      <iron-form id="iform">
        <form>
          <vaadin-text-field name="foo"></vaadin-text-field>
        </form>
      </iron-form>
    </template>
  </test-fixture>

  <script>

    describe('validate', function() {
      var iform, vinput;

      beforeEach(function(done) {
        iform = fixture('default');
        window.setTimeout(function() {
          vinput = iform.querySelector('vaadin-text-field');
          done();
        }, 1);
      });

      it('should call validate', function() {
        var inputFocusSpy = window.sinon.spy(vinput, 'validate');
        iform.submit();
        expect(inputFocusSpy.called).to.be.true;
      });

      it('should serialize correctly', function() {
        vinput.value = 'bar';
        expect(iform.serializeForm().foo).to.equal('bar');
      });

      it('should pass if not required', function() {
        expect(iform.validate()).to.be.true;
      });

      it('should fail if required', function() {
        vinput.required = true;
        expect(iform.validate()).to.be.false;
      });

      it('should have the invalid attribute', function() {
        vinput.required = true;
        vinput.validate();
        expect(vinput.getAttribute('invalid')).to.be.equal('');
      });

      it('should not have the invalid attribute', function() {
        vinput.required = true;
        vinput.validate();
        vinput.required = false;
        vinput.validate();
        expect(vinput.getAttribute('invalid')).not.to.be.ok;
      });

    });
  </script>
</body>
